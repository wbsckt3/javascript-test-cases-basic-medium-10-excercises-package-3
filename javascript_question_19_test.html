
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refactorii</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mocha/8.4.0/mocha.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.6.3/dist/vuetify.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>  
    <link rel="stylesheet" href="https://wbsckt3.github.io/mocha_test_cases_styles_2/style.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.6.3/dist/vuetify.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuex@3.6.2/dist/vuex.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mocha/8.4.0/mocha.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chai/4.3.4/chai.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/javascript/javascript.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode@4.0.0/build/cjs/index.min.js"></script>
</head>
<body>
    <div id="editor-container">
        <textarea id="code-editor">
// Ensure the shape namespace is defined
var shape = shape || {};

shape.StringUtils = {
  signedEightBitNumber: function(str) {
    // Check if the string represents an integer
    if (!/^-?\d+$/.test(str)) {
      return false;
    }
    
    // Convert string to a number
    const num = Number(str);
    
    // Check if the number is within the 8-bit signed integer range
    return num >= -128 && num <= 127;
  }
};

// Console logs for testing the function
console.log("Test: -128 should be valid");
console.log(shape.StringUtils.signedEightBitNumber("-128")); // Expected: true

console.log("Test: 127 should be valid");
console.log(shape.StringUtils.signedEightBitNumber("127")); // Expected: true

console.log("Test: 0 should be valid");
console.log(shape.StringUtils.signedEightBitNumber("0")); // Expected: true

console.log("Test: -1 should be valid");
console.log(shape.StringUtils.signedEightBitNumber("-1")); // Expected: true

console.log("Test: 56 should be valid");
console.log(shape.StringUtils.signedEightBitNumber("56")); // Expected: true

console.log("Test: -129 is out of range");
console.log(shape.StringUtils.signedEightBitNumber("-129")); // Expected: false

console.log("Test: 128 is out of range");
console.log(shape.StringUtils.signedEightBitNumber("128")); // Expected: false

console.log("Test: 999 is out of range");
console.log(shape.StringUtils.signedEightBitNumber("999")); // Expected: false

console.log("Test: Leading space should invalidate");
console.log(shape.StringUtils.signedEightBitNumber(" 123")); // Expected: false

console.log("Test: Leading + should invalidate");
console.log(shape.StringUtils.signedEightBitNumber("+123")); // Expected: false

console.log("Test: Leading 0 should invalidate");
console.log(shape.StringUtils.signedEightBitNumber("0123")); // Expected: false

console.log("Test: Decimal point should invalidate");
console.log(shape.StringUtils.signedEightBitNumber("1.23")); // Expected: false

console.log("Test: Non-numeric string should be invalid");
console.log(shape.StringUtils.signedEightBitNumber("abc")); // Expected: false

console.log("Test: String with non-digit characters should be invalid");
console.log(shape.StringUtils.signedEightBitNumber("12a")); // Expected: false

        </textarea>
	<img id="logo" src="https://wbsckt3.github.io/javascript-test-cases-basic-medium-10-excercises-package/logo_refactorii.png" alt="Logo Refactorii">
        <button id="run-button">Run</button>
    </div>
    <div id="app-container">
        <div id="app">
	    <h5>Challenge: 8-Bit Signed Number Validation</h5>
            <div id="modify-message">The concept involves checking if a given number is representable as an 8-bit signed integer. An 8-bit signed integer can store numbers from -128 to 127 ...</div>
	    <button id="send-response-button" onClick= "guardarResultados()">Send Response</button>
        </div>
    </div>
    <div id="console-container"><div id="console"></div></div>
    <div id="mocha-container"><div id="mocha"></div></div>
    <script>mocha.setup('bdd');</script>

    <!-- Modal -->
    <div class="modal fade" id="errorMessageModal" tabindex="-1" role="dialog" aria-labelledby="errorMessageModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="errorMessageModalLabel">Concept</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="errorMessageModalBody">
                    <!-- Contenido del mensaje de error -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <script>
    	 // Obtener el parÃ¡metro `token` de la URL
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');
    if (token) {
	    // Realiza una solicitud al servicio externo para validar el token
	    fetch(`https://www.refactorii.com/validate-token?token=${token}`)
	    .then(response => response.json())
	    .then(data => {
	        if (data.valid) {
	            console.log(data.valid);
	             // Decodifica el token para obtener el payload
                     const decodedToken = decodeJwtResponse(token);
         	     const recipeId = decodedToken._id; // AsegÃºrate de usar el nombre correcto del campo en el payload
                     console.log('Recipe ID:', recipeId);
		     // Almacenar recipeId en local storage
                     localStorage.setItem('recipeId', recipeId);
	             // Llama a la funciÃ³n de prueba
	             test_cases_scenario();
	        } else {
	            console.log(data.valid);
	            document.body.innerHTML = 'Access denied. Invalid token.';
	        }
	    }).catch(error => {
	        document.body.innerHTML = 'Error validating token.';
	        console.error('Error:', error);
	    });
    } else {
	    document.body.innerHTML = 'Access denied. No token provided.';
    }
    function test_cases_scenario(){	    
        const editor = CodeMirror.fromTextArea(document.getElementById('code-editor'), {
            lineNumbers: true,
            mode: 'javascript',
            lineWrapping: true,
            scrollbarStyle: 'null'
        });
        
        var modal_click_message = `This problem challenges you to continue coding the function to sort an array of positive integers...`;
        var error_message = `Description:<br><br>
	The Adapter Design Pattern allows integrating an external character or component into an existing system, making it compatible without 
        altering its source code. In this challenge, we'll use this pattern to adapt a non-standard character, Mario, into a system that expects a common interface for attack actions.
	<br><br>
	Task:
	<br><br>
	Create an adapter class, MarioAdapter, that allows a Mario instance to be used like other unit classes (Marine, Zealot, Zergling). The adapter should allow Mario to "attack" by leveraging his jumpAttack method.`;       
	var success_message = `Congratulations on completing this challenging task! ðŸŽ‰ You've successfully applied the Adapter Design Pattern, a crucial concept in software design. By adapting Mario's unique abilities into a common interface, 
        you've demonstrated a deep understanding of how to integrate diverse components seamlessly. `
        
        // FunciÃ³n para mostrar el modal con el mensaje de error
        document.getElementById('modify-message').addEventListener('click', function() {
            $('#errorMessageModalBody').html(error_message); // Coloca el contenido del error en el cuerpo del modal
            $('#errorMessageModal').modal('show'); // Muestra el modal
        });

        function logToConsole(message, color) {
            const consoleElement = document.getElementById('console');
            const messageElement = document.createElement('div');
            messageElement.textContent = message;
            if (color) {
                messageElement.style.color = color;
                messageElement.style.fontWeight = 'bold';
            }
            consoleElement.appendChild(messageElement);
        }

        document.getElementById('run-button').addEventListener('click', function() {
            // Clear previous results
            document.getElementById('console').innerHTML = '';
            document.getElementById('mocha').innerHTML = '';
            mocha.suite.suites = []; // Clear previous test cases
            // Get the user's code from the editor
            const userCode = editor.getValue();
		
            // Redirect console.log to custom console
	    const output = [];
	    const originalConsoleLog = console.log;
	    /*console.log = function(message) {
		output.push(message);
		logToConsole(message);
	    };*/
	    // Show "Ejecutando tests..." message and delay tests
	    logToConsole('Running tests....', '#67e810');
		console.log = function(...args) {
                const message = args.join(' ');
                originalConsoleLog.apply(console, args); // Still log to the original console
                logToConsole(message);
            };
		
  	    setTimeout(() => {
            	// Evaluate the user's code
            	try {
                    const userFunction = new Function(userCode + '; return shape;');  
                    const shape = userFunction();
                    // Define test cases
                    const expect = chai.expect;
		    const assert = chai.assert;	

describe("shape.StringUtils.signedEightBitNumber", function() {
  it("should return true for valid 8-bit signed integers", function() {
    console.log("Test: -128 should be valid");
    console.log(shape.StringUtils.signedEightBitNumber("-128")); // Expected: true
    
    console.log("Test: 127 should be valid");
    console.log(shape.StringUtils.signedEightBitNumber("127")); // Expected: true
    
    console.log("Test: 0 should be valid");
    console.log(shape.StringUtils.signedEightBitNumber("0")); // Expected: true
    
    console.log("Test: -1 should be valid");
    console.log(shape.StringUtils.signedEightBitNumber("-1")); // Expected: true
    
    console.log("Test: 56 should be valid");
    console.log(shape.StringUtils.signedEightBitNumber("56")); // Expected: true
  });

  it("should return false for numbers outside the 8-bit signed range", function() {
    console.log("Test: -129 is out of range");
    console.log(shape.StringUtils.signedEightBitNumber("-129")); // Expected: false
    
    console.log("Test: 128 is out of range");
    console.log(shape.StringUtils.signedEightBitNumber("128")); // Expected: false
    
    console.log("Test: 999 is out of range");
    console.log(shape.StringUtils.signedEightBitNumber("999")); // Expected: false
  });

  it("should return false for non-canonical representations", function() {
    console.log("Test: Leading space should invalidate");
    console.log(shape.StringUtils.signedEightBitNumber(" 123")); // Expected: false
    
    console.log("Test: Leading + should invalidate");
    console.log(shape.StringUtils.signedEightBitNumber("+123")); // Expected: false
    
    console.log("Test: Leading 0 should invalidate");
    console.log(shape.StringUtils.signedEightBitNumber("0123")); // Expected: false
    
    console.log("Test: Decimal point should invalidate");
    console.log(shape.StringUtils.signedEightBitNumber("1.23")); // Expected: false
  });

  it("should return false for non-numeric strings", function() {
    console.log("Test: Non-numeric string should be invalid");
    console.log(shape.StringUtils.signedEightBitNumber("abc")); // Expected: false
    
    console.log("Test: String with non-digit characters should be invalid");
    console.log(shape.StringUtils.signedEightBitNumber("12a")); // Expected: false
  });
});


		// Variable para rastrear el estado de los tests
                let allTestsPassed = true;	
 	        // Run Mocha tests
                mocha.run()
                    .on('test', function(test) {
                        logToConsole('â€¢ Running test: ' + test.title);
                    })
                    .on('test end', function(test) {
                        logToConsole('â€¢ Test finished: ' + test.title);
                    })
                    .on('pass', function(test) {
                        logToConsole('â€¢ Test passed: ' + test.title);
                    })
                    .on('fail', function(test, err) {
			logToConsole('â€¢ Test failed: ' + test.title + ' - ' + err.message);
			success_message = modal_click_message;
			const runButton = document.getElementById('run-button');
			runButton.innerText = 'Reintentar';
			runButton.style.backgroundColor = '#ff0000ad';
			runButton.onclick = function() {
			    window.location.reload();
			};
			allTestsPassed = false; // Si cualquier test falla, actualizamos la variable	
		     })
		     .on('end', function() {
			logToConsole('â€¢ All tests finished!');
			document.getElementById('modify-message').innerText = success_message;
			document.getElementById('modify-message').style.display = 'block';
			document.getElementById('modify-message').style.color = 'black';
			if (allTestsPassed) {
		               const sendResponseButton = document.getElementById('send-response-button');
		               sendResponseButton.classList.add('enabled');
		        } 
		     });

            } catch (e) {
                console.error('Error evaluating user code:', e);
                logToConsole('Error: ' + e.message, 'red');
            } finally {
                // Restore original console.log
                console.log = originalConsoleLog;
            }
			
		}, 3000); // 3 seconds delay
        });
    }
	    
    async function guardarResultados() {
	    const formData = JSON.parse(localStorage.getItem("formData"));
	    const email = formData ? formData.Email : null;
            const recipeId = localStorage.getItem('recipeId'); // Recuperar recipeId de local storage
	    // Crear el objeto que se guardarÃ¡ en la base de datos
	    // Obtener la URL actual
	    const currentUrl = window.location.href;
	    // Crear un objeto URL
	    const url = new URL(currentUrl);
	    // Eliminar el parÃ¡metro 'token' de la query string
	    url.searchParams.delete('token');
	    // Obtener el pathname sin el token
            const urlWithoutToken = url.pathname.split('/').pop();
	    const recipeCalificadaOk = {
	        recipeId: recipeId,
		url: urlWithoutToken,
	        date: new Date().toISOString()
	    };
	    try {
	        const response = await fetch('https://www.refactorii.com/updateOneGoogleSigninUserRecipe', {
	            method: 'POST',
	            headers: {
	                'Content-Type': 'application/json'
	            },
	            //body: JSON.stringify({ Email: email, recipeCalificadaOk: recipeId })
		    body: JSON.stringify({ Email: email, recipeCalificadaOk })	
	        });
	        const data = await response.json();
	        console.log('Server responds:', "Ok");
		// RedirecciÃ³n a la pÃ¡gina original
                window.location.href = `https://www.refactorii.com/recipes/${recipeId}`;
	    } catch (error) {
	        console.error('Error sending the results to the server:', error);
	    }
    }

    function decodeJwtResponse(token) {
	    var base64Url = token.split('.')[1];
	    var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
	    var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
	        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
	    }).join(''));
	    return JSON.parse(jsonPayload);
    }
    </script>
</body>
</html>
